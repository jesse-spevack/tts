<div class="max-w-2xl mx-auto">
  <%= render "shared/page_header", title: "Create New Episode" %>

  <%= render "shared/card", padding: "p-4 sm:p-8" do %>
    <div data-controller="tab-switch">
      <!-- Segmented Control -->
      <div class="flex bg-[var(--color-base)] rounded-lg p-1 mb-6">
        <button
          type="button"
          data-tab-switch-target="tab"
          data-tab="url"
          data-action="click->tab-switch#switch"
          class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-[var(--color-surface0)] text-[var(--color-text)]"
        >
          From URL
        </button>
        <button
          type="button"
          data-tab-switch-target="tab"
          data-tab="paste"
          data-action="click->tab-switch#switch"
          class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-[var(--color-subtext)]"
        >
          Paste Text
        </button>
        <button
          type="button"
          data-tab-switch-target="tab"
          data-tab="file"
          data-action="click->tab-switch#switch"
          class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-[var(--color-subtext)]"
        >
          Upload File
        </button>
      </div>

      <!-- URL Form Panel -->
      <div data-tab-switch-target="panel" data-tab="url">
        <%= form_with url: episodes_path, local: true, class: "space-y-6" do |f| %>
          <div>
            <%= f.label :url, "Article URL", class: label_classes %>
            <%= f.url_field :url,
                class: input_classes,
                placeholder: "https://example.com/article",
                required: true %>
            <p class="mt-2 text-sm text-[var(--color-subtext)]">
              We'll extract the article content, title, and author automatically.
            </p>
          </div>

          <div class="flex flex-col sm:flex-row sm:items-center gap-4 pt-4">
            <%= f.submit "Create Episode", class: button_classes(type: :primary, full_width: false) + " sm:w-auto w-full" %>
            <%= link_to "Cancel", episodes_path, class: button_classes(type: :text) + " text-center" %>
          </div>
        <% end %>
      </div>

      <!-- Paste Text Form Panel -->
      <div data-tab-switch-target="panel" data-tab="paste" class="hidden">
        <%= form_with url: episodes_path, local: true, class: "space-y-6" do |f| %>
          <div>
            <%= f.label :text, "Article Text", class: label_classes %>
            <%= f.text_area :text,
                rows: 12,
                class: input_classes,
                placeholder: "Paste your article text here...",
                required: true %>
            <p class="mt-2 text-sm text-[var(--color-subtext)]">
              Paste article text. We'll extract the title and author automatically.
            </p>
          </div>

          <div class="flex flex-col sm:flex-row sm:items-center gap-4 pt-4">
            <%= f.submit "Create Episode", class: button_classes(type: :primary, full_width: false) + " sm:w-auto w-full" %>
            <%= link_to "Cancel", episodes_path, class: button_classes(type: :text) + " text-center" %>
          </div>
        <% end %>
      </div>

      <!-- File Form Panel -->
      <div data-tab-switch-target="panel" data-tab="file" class="hidden">
        <%= form_with model: @episode, url: episodes_path, local: true, multipart: true, class: "space-y-6" do |f| %>
          <% if @episode.errors.any? %>
            <div class="border border-[var(--color-red)] rounded-lg p-4 bg-[var(--color-red)]/10">
              <p class="text-[var(--color-red)] font-medium mb-2">Please fix the following errors:</p>
              <ul class="list-disc list-inside text-sm text-[var(--color-red)]">
                <% @episode.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <div>
            <%= f.label :title, class: label_classes %>
            <%= f.text_field :title,
                class: input_classes,
                placeholder: "My Awesome Episode" %>
          </div>

          <div>
            <%= f.label :author, class: label_classes %>
            <%= f.text_field :author,
                class: input_classes,
                placeholder: "Your Name" %>
          </div>

          <div>
            <%= f.label :description, class: label_classes %>
            <%= f.text_area :description,
                rows: 3,
                class: input_classes,
                placeholder: "A brief description of this episode..." %>
          </div>

          <div data-controller="file-upload">
            <%= f.label :content, "Markdown Content", class: label_classes %>
            <div
              data-file-upload-target="dropzone"
              data-action="click->file-upload#triggerInput dragover->file-upload#handleDragOver dragleave->file-upload#handleDragLeave drop->file-upload#handleDrop"
              class="border-2 border-dashed border-[var(--color-overlay0)] rounded-lg p-4 sm:p-8 text-center cursor-pointer hover:border-[var(--color-primary)] transition-colors"
            >
              <%= f.file_field :content,
                  accept: ".md,.markdown,.txt",
                  required: true,
                  data: { file_upload_target: "input", action: "change->file-upload#updateFilename" },
                  class: "hidden" %>
              <p class="text-[var(--color-subtext)] mb-2">Click to upload or drag and drop<br>(.md or .txt)</p>
              <p data-file-upload-target="filename" class="hidden text-sm font-medium text-[var(--color-primary)]"></p>
            </div>
          </div>

          <div class="flex flex-col sm:flex-row sm:items-center gap-4 pt-4">
            <%= f.submit "Create Episode", class: button_classes(type: :primary, full_width: false) + " sm:w-auto w-full" %>
            <%= link_to "Cancel", episodes_path, class: button_classes(type: :text) + " text-center" %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

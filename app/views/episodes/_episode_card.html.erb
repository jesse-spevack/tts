<%= turbo_frame_tag dom_id(episode), data: { testid: "episode-card" } do %>
  <li class="relative">
    <% row_classes = "flex items-center gap-4 py-4 px-2 -mx-2 rounded-lg" %>
    <% if episode.complete? %>
      <%= link_to episode_path(episode.prefix_id), class: "#{row_classes} hover:bg-mist-50 dark:hover:bg-mist-800 group transition-colors", data: { turbo_frame: "_top" } do %>
        <%= status_dot(episode.status) %>
        <div class="flex-1 min-w-0">
          <p class="text-sm/6 font-medium text-mist-950 dark:text-white truncate"><%= episode.title %></p>
          <p class="text-sm/6 text-mist-500 dark:text-mist-400 truncate">
            by <%= episode.author %><% if episode.created_at %> &middot; <%= episode.created_at.strftime("%b %d, %Y") %><% end %>
          </p>
        </div>
        <% if episode.duration_seconds %>
          <span class="text-sm text-mist-500 dark:text-mist-400 flex-shrink-0"><%= format_duration(episode.duration_seconds) %></span>
        <% end %>
        <svg class="size-5 text-mist-400 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
        </svg>
      <% end %>
    <% else %>
      <div class="<%= row_classes %>">
        <%= status_dot(episode.status) %>
        <div class="flex-1 min-w-0">
          <p class="text-sm/6 font-medium text-mist-950 dark:text-white truncate"><%= episode.title %></p>
          <p class="text-sm/6 text-mist-500 dark:text-mist-400 truncate">
            <% if episode.processing? && episode.processing_started_at.present? %>
              <% eta_seconds = processing_eta(episode) %>
              <% if eta_seconds %>
                <span data-controller="eta-countdown"
                      data-eta-countdown-estimated-seconds-value="<%= eta_seconds %>"
                      data-eta-countdown-started-at-value="<%= episode.processing_started_at.iso8601 %>">
                  <span class="text-mist-500 dark:text-mist-400">Generating audio</span>
                  &middot;
                  <span data-eta-countdown-target="display" aria-live="polite" aria-atomic="true" class="text-mist-400 dark:text-mist-500"></span>
                </span>
              <% else %>
                <span class="text-mist-500 dark:text-mist-400">Generating audio...</span>
              <% end %>
            <% elsif episode.pending? %>
              <span class="text-mist-500 dark:text-mist-400">Queued...</span>
            <% else %>
              <%= status_badge(episode.status) %>
              <% if episode.failed? && episode.error_message.present? %>
                &mdash; <span class="text-rose-600 dark:text-rose-400"><%= episode.error_message %></span>
              <% end %>
            <% end %>
          </p>
        </div>
        <% if deletable?(episode) %>
          <%= button_to episode_path(episode, page: params[:page]),
            method: :delete,
            form_class: "contents",
            class: "text-mist-400 hover:text-rose-600 dark:hover:text-rose-400 transition-colors cursor-pointer flex-shrink-0",
            title: "Delete episode",
            data: { turbo_confirm: "Are you sure you want to delete '#{episode.title}'?" } do %>
            <%= render "shared/icons/trash" %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </li>
<% end %>

<% content_for :title, "Extension Connected" %>

<div class="flex justify-center items-center min-h-[calc(100vh-10rem)]">
  <div class="w-full max-w-md text-center">
    <!-- Success Icon -->
    <div class="mx-auto flex size-12 items-center justify-center rounded-full bg-[var(--color-green)]/10">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-[var(--color-green)]">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
      </svg>
    </div>

    <!-- Heading -->
    <h1 class="mt-4 text-xl font-semibold text-[var(--color-text)]">Extension Connected</h1>

    <!-- Status Message -->
    <p id="status-message" class="mt-2 text-sm text-[var(--color-subtext)]">
      Connecting to extension...
    </p>

    <!-- Link back -->
    <p class="mt-6">
      <%= link_to "Return to TTS", root_path, class: "text-sm text-[var(--color-primary)] hover:underline" %>
    </p>
  </div>
</div>

<!-- Hidden token for extension to read (not visible to user) -->
<script>
  (function() {
    const token = "<%= @api_token.plain_token %>";
    const statusEl = document.getElementById('status-message');

    // Set data attribute for extension content script to read
    document.body.setAttribute('data-tts-token', token);
    document.body.setAttribute('data-tts-connect-status', 'ready');

    // Dispatch custom event for extension
    window.dispatchEvent(new CustomEvent('tts-extension-token', {
      detail: { token: token }
    }));

    // Update status
    setTimeout(function() {
      statusEl.textContent = 'Your extension is now connected.';
    }, 500);
  })();
</script>

<div class="mx-auto max-w-4xl">
  <%= render "shared/back_link", path: episodes_path, text: "Back to Episodes" %>
  <%= render "shared/page_header", title: "Settings" %>

  <div class="space-y-12">
    <%# Voice section %>
    <div class="grid grid-cols-1 gap-x-8 gap-y-10 border-b border-mist-950/10 pb-12 md:grid-cols-3 dark:border-white/10">
      <div>
        <h2 class="text-base/7 font-semibold text-mist-950 dark:text-white">Voice</h2>
        <p class="mt-1 text-sm/6 text-mist-500 dark:text-mist-400">Choose the voice for your podcast episodes.</p>
      </div>
      <div class="md:col-span-2">
        <div class="rounded-xl bg-white p-6 shadow-sm ring-1 ring-mist-950/5 dark:bg-mist-800 dark:ring-white/10">
          <%= form_with url: settings_path, method: :patch, class: "space-y-6" do %>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <% @voices.each do |voice| %>
                <label class="relative flex cursor-pointer rounded-lg border border-mist-300 bg-white p-4 shadow-sm transition-colors dark:border-mist-700 dark:bg-mist-800 has-[:checked]:border-mist-950 has-[:checked]:ring-2 has-[:checked]:ring-mist-950 dark:has-[:checked]:border-white dark:has-[:checked]:ring-white">
                  <input type="radio" name="voice" value="<%= voice[:key] %>"
                         <%= "checked" if @selected_voice == voice[:key] %>
                         class="peer sr-only">
                  <span class="flex flex-1 flex-col">
                    <span class="text-sm/6 font-medium text-mist-950 dark:text-white"><%= voice[:name] %></span>
                    <span class="mt-1 text-sm/6 text-mist-500 dark:text-mist-400">
                      <%= voice[:accent] %> &middot; <%= voice[:gender] %>
                    </span>
                    <span data-controller="audio-preview" data-audio-preview-url-value="<%= voice[:sample_url] %>" class="mt-3 flex items-center gap-3">
                      <button type="button"
                              data-audio-preview-target="button"
                              data-action="click->audio-preview#toggle"
                              class="text-sm text-mist-950 hover:opacity-70 inline-flex items-center gap-1 dark:text-white">
                        <span data-audio-preview-target="playIcon"><%= render "shared/icons/play" %></span>
                        <span data-audio-preview-target="pauseIcon" class="hidden"><%= render "shared/icons/pause" %></span>
                        Preview
                      </button>
                      <button type="button"
                              data-action="click->audio-preview#restart"
                              class="text-mist-500 hover:text-mist-950 dark:text-mist-400 dark:hover:text-white"
                              title="Restart">
                        <%= render "shared/icons/restart" %>
                      </button>
                    </span>
                  </span>
                  <span class="invisible text-mist-950 peer-checked:visible dark:text-white">
                    <%= render "shared/icons/check_circle_solid" %>
                  </span>
                </label>
              <% end %>
            </div>

            <%= submit_tag "Save Changes", class: button_classes(type: :primary) %>
          <% end %>
        </div>
      </div>
    </div>

    <% if Current.user.premium? %>
      <%# Billing section %>
      <div class="grid grid-cols-1 gap-x-8 gap-y-10 border-b border-mist-950/10 pb-12 md:grid-cols-3 dark:border-white/10">
        <div>
          <h2 class="text-base/7 font-semibold text-mist-950 dark:text-white">Billing</h2>
          <p class="mt-1 text-sm/6 text-mist-500 dark:text-mist-400">Manage your subscription and payment details.</p>
        </div>
        <div class="md:col-span-2">
          <div class="rounded-xl bg-white p-6 shadow-sm ring-1 ring-mist-950/5 dark:bg-mist-800 dark:ring-white/10">
            <%= link_to "Manage Billing", billing_path, class: button_classes(type: :secondary) %>
          </div>
        </div>
      </div>
    <% end %>

    <%# Browser Extension section %>
    <div class="grid grid-cols-1 gap-x-8 gap-y-10 border-b border-mist-950/10 pb-12 md:grid-cols-3 dark:border-white/10">
      <div>
        <h2 class="text-base/7 font-semibold text-mist-950 dark:text-white">Browser Extension</h2>
        <p class="mt-1 text-sm/6 text-mist-500 dark:text-mist-400">Send articles to your podcast from any webpage.</p>
      </div>
      <div class="md:col-span-2">
        <div class="rounded-xl bg-white p-6 shadow-sm ring-1 ring-mist-950/5 dark:bg-mist-800 dark:ring-white/10">
          <%= link_to "Manage Extension", settings_extensions_path, class: button_classes(type: :secondary) %>
        </div>
      </div>
    </div>

    <%# Email to Podcast section %>
    <div class="grid grid-cols-1 gap-x-8 gap-y-10 pb-12 md:grid-cols-3">
      <div>
        <h2 class="text-base/7 font-semibold text-mist-950 dark:text-white">Email to Podcast</h2>
        <p class="mt-1 text-sm/6 text-mist-500 dark:text-mist-400">Create podcast episodes by forwarding content via email.</p>
      </div>
      <div class="md:col-span-2">
        <div class="rounded-xl bg-white p-6 shadow-sm ring-1 ring-mist-950/5 dark:bg-mist-800 dark:ring-white/10">
          <% if Current.user.email_episodes_enabled? %>
            <p class="text-sm/6 text-mist-500 dark:text-mist-400 mb-4">
              Send content to this address to create podcast episodes:
            </p>

            <div class="flex items-center gap-2 mb-4">
              <code class="flex-1 rounded-md border border-mist-200 bg-white px-3 py-2 font-mono text-sm break-all dark:border-mist-700 dark:bg-mist-800">
                <%= @email_ingest_address %>
              </code>
              <%= render "shared/clipboard_button",
                content: @email_ingest_address,
                title: "Copy email address",
                icon: "copy",
                button_class: "text-mist-500 dark:text-mist-400 hover:text-mist-950 dark:hover:text-white transition-colors cursor-pointer flex-shrink-0"
              %>
            </div>

            <div class="flex flex-wrap gap-2 mb-4">
              <%= button_to "Regenerate Address", settings_email_token_path,
                  method: :post, class: button_classes(type: :secondary),
                  data: { turbo_confirm: "This will invalidate your current email address. Continue?" } %>
              <%= button_to "Disable", settings_email_episodes_path,
                  method: :delete, class: button_classes(type: :danger) %>
            </div>

            <div class="border-t border-mist-200 pt-4 dark:border-mist-700">
              <%= form_with url: settings_path, method: :patch do %>
                <label class="group flex cursor-pointer items-center gap-3">
                  <input type="hidden" name="email_episode_confirmation" value="0">
                  <input type="checkbox" name="email_episode_confirmation" value="1"
                         <%= "checked" if Current.user.email_episode_confirmation? %>
                         class="peer sr-only">
                  <span class="relative h-6 w-11 rounded-full bg-mist-200 transition-colors duration-200
                               after:absolute after:left-0.5 after:top-0.5 after:h-5 after:w-5
                               after:rounded-full after:bg-white after:transition-transform after:duration-200
                               after:content-[''] peer-checked:bg-mist-950 peer-checked:after:translate-x-5
                               peer-focus:ring-2 peer-focus:ring-mist-950/50
                               dark:bg-mist-700 dark:after:bg-mist-950 dark:peer-checked:bg-white
                               dark:peer-focus:ring-white/50"></span>
                  <span class="text-sm/6 text-mist-950 dark:text-white">Send confirmation email when episodes are created</span>
                </label>

                <%= submit_tag "Save", class: "#{button_classes(type: :primary)} mt-4" %>
              <% end %>
            </div>
          <% else %>
            <p class="text-sm/6 text-mist-500 dark:text-mist-400 mb-4">
              Enable email episodes to get a unique email address for creating episodes by forwarding content.
            </p>

            <%= button_to "Enable Email Episodes", settings_email_episodes_path,
                method: :post, class: button_classes(type: :primary) %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

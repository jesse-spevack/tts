<div class="max-w-2xl mx-auto">
  <%= link_to episodes_path, class: "text-sm text-[var(--color-subtext)] hover:text-[var(--color-text)] mb-4 inline-flex items-center gap-1" do %>
    <%= render "shared/icons/arrow_left" %> Back to Episodes
  <% end %>
  <h1 class="text-2xl font-semibold mb-8">Settings</h1>

  <%= render "shared/card", padding: "p-4 sm:p-8" do %>
    <%= form_with url: settings_path, method: :patch, class: "space-y-6" do %>
      <h2 class="text-lg font-medium">Voice</h2>
      <p class="text-[var(--color-subtext)] text-sm">Choose the voice for your podcast episodes.</p>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <% @voices.each do |voice| %>
          <div class="relative block">
            <input type="radio" name="voice" value="<%= voice[:key] %>" id="voice_<%= voice[:key] %>"
                   <%= "checked" if @selected_voice == voice[:key] %>
                   class="peer sr-only">
            <label for="voice_<%= voice[:key] %>" class="block border-2 rounded-lg p-4 transition-colors cursor-pointer
                        border-[var(--color-overlay0)] peer-checked:border-[var(--color-primary)]
                        peer-checked:bg-[var(--color-primary)]/5">
              <div class="flex items-center justify-between mb-2">
                <span class="font-medium"><%= voice[:name] %></span>
                <div class="w-4 h-4 rounded-full border-2 transition-colors flex items-center justify-center
                            border-[var(--color-overlay0)] peer-checked:border-[var(--color-primary)]">
                  <div class="w-2 h-2 rounded-full transition-colors scale-0 peer-checked:scale-100 bg-[var(--color-primary)]"></div>
                </div>
              </div>
              <p class="text-sm text-[var(--color-subtext)]">
                <%= voice[:accent] %> &middot; <%= voice[:gender] %>
              </p>
              <div data-controller="audio-preview" data-audio-preview-url-value="<%= voice[:sample_url] %>" class="mt-3 flex items-center gap-3">
                <button type="button"
                        data-audio-preview-target="button"
                        data-action="click->audio-preview#toggle click->audio-preview#stopPropagation"
                        class="text-sm text-[var(--color-primary)] hover:opacity-70 inline-flex items-center gap-1">
                  <span data-audio-preview-target="playIcon"><%= render "shared/icons/play" %></span>
                  <span data-audio-preview-target="pauseIcon" class="hidden"><%= render "shared/icons/pause" %></span>
                  Preview
                </button>
                <button type="button"
                        data-action="click->audio-preview#restart click->audio-preview#stopPropagation"
                        class="text-[var(--color-subtext)] hover:text-[var(--color-text)]"
                        title="Restart">
                  <%= render "shared/icons/restart" %>
                </button>
              </div>
            </label>
          </div>
        <% end %>
      </div>

      <%= submit_tag "Save Changes", class: button_classes(type: :primary) %>
    <% end %>
  <% end %>
</div>
